<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—Ä–µ–∫–µ—Ä –ü—Ä–∏–≤—ã—á–µ–∫</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .habit-table {
            min-width: 100%;
            display: inline-block;
            overflow-x: auto;
        }
        
        .sticky-left {
            position: sticky;
            left: 0;
            background-color: white;
            z-index: 10;
        }
        
        .sticky-right {
            position: sticky;
            right: 0;
            background-color: white;
            z-index: 10;
        }
        
        .sticky-header {
            position: sticky;
            left: 0;
            background-color: #f3f4f6;
            z-index: 20;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
    <div class="max-w-7xl mx-auto">
        <div class="bg-white rounded-lg shadow-xl p-4 md:p-6 mb-6">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                <i data-lucide="bar-chart-3" class="w-8 h-8 mr-3 text-indigo-600"></i>
                –¢—Ä–µ–∫–µ—Ä –ü—Ä–∏–≤—ã—á–µ–∫
            </h1>

            <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø—Ä–∏–≤—ã—á–∫–∏ -->
            <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                <h2 class="text-lg font-semibold mb-3">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</h2>
                <div class="flex flex-col md:flex-row gap-3">
                    <input
                        type="text"
                        id="newHabitName"
                        placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏"
                        class="flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    />
                    <input
                        type="number"
                        id="newHabitGoal"
                        value="30"
                        placeholder="–¶–µ–ª—å (–¥–Ω–µ–π)"
                        class="w-full md:w-32 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    />
                    <button
                        id="addHabitBtn"
                        class="bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700 transition flex items-center justify-center"
                    >
                        <i data-lucide="plus" class="w-5 h-5 mr-1"></i>
                        –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                </div>
            </div>

            <!-- –í—ã–±–æ—Ä –º–µ—Å—è—Ü–∞ –∏ –≤–∏–¥–∞ -->
            <div class="mb-4 flex flex-col md:flex-row gap-3 items-center justify-between">
                <div class="flex gap-3 items-center">
                    <i data-lucide="calendar" class="w-5 h-5 text-gray-600"></i>
                    <select
                        id="monthSelect"
                        class="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500"
                    >
                        <!-- –ú–µ—Å—è—Ü—ã –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </select>
                    <select
                        id="yearSelect"
                        class="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500"
                    >
                        <option value="2024">2024</option>
                        <option value="2025" selected>2025</option>
                        <option value="2026">2026</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button
                        id="weeklyViewBtn"
                        class="px-4 py-2 rounded transition bg-indigo-600 text-white"
                    >
                        –ü–æ –Ω–µ–¥–µ–ª—è–º
                    </button>
                    <button
                        id="dailyViewBtn"
                        class="px-4 py-2 rounded transition bg-gray-200 text-gray-700 hover:bg-gray-300"
                    >
                        –ü–æ –¥–Ω—è–º
                    </button>
                </div>
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–∏–≤—ã—á–µ–∫ -->
            <div id="habitsContainer">
                <div class="text-center py-12 text-gray-500">
                    <p class="text-lg">–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –ø—Ä–∏–≤—ã—á–∫—É!</p>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div id="statsContainer" class="bg-white rounded-lg shadow-xl p-4 md:p-6 hidden">
            <h2 class="text-xl font-bold mb-4">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ <span id="currentMonth">–Ø–Ω–≤–∞—Ä—å</span></h2>
            <div id="statsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∫–æ–Ω–æ–∫ Lucide
        lucide.createIcons();

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const state = {
            habits: JSON.parse(localStorage.getItem('habits')) || [],
            selectedMonth: new Date().getMonth(),
            selectedYear: new Date().getFullYear(),
            view: 'daily'
        };

        const months = [
            '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
            '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
        ];

        const weekDays = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            initMonthSelect();
            initEventListeners();
            render();
        });

        function initMonthSelect() {
            const monthSelect = document.getElementById('monthSelect');
            months.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = month;
                if (index === state.selectedMonth) option.selected = true;
                monthSelect.appendChild(option);
            });
        }

        function initEventListeners() {
            document.getElementById('addHabitBtn').addEventListener('click', addHabit);
            document.getElementById('newHabitName').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addHabit();
            });
            document.getElementById('monthSelect').addEventListener('change', (e) => {
                state.selectedMonth = parseInt(e.target.value);
                render();
            });
            document.getElementById('yearSelect').addEventListener('change', (e) => {
                state.selectedYear = parseInt(e.target.value);
                render();
            });
            document.getElementById('weeklyViewBtn').addEventListener('click', () => {
                state.view = 'weekly';
                updateViewButtons();
                render();
            });
            document.getElementById('dailyViewBtn').addEventListener('click', () => {
                state.view = 'daily';
                updateViewButtons();
                render();
            });
        }

        function updateViewButtons() {
            const weeklyBtn = document.getElementById('weeklyViewBtn');
            const dailyBtn = document.getElementById('dailyViewBtn');
            
            if (state.view === 'weekly') {
                weeklyBtn.className = 'px-4 py-2 rounded transition bg-indigo-600 text-white';
                dailyBtn.className = 'px-4 py-2 rounded transition bg-gray-200 text-gray-700 hover:bg-gray-300';
            } else {
                weeklyBtn.className = 'px-4 py-2 rounded transition bg-gray-200 text-gray-700 hover:bg-gray-300';
                dailyBtn.className = 'px-4 py-2 rounded transition bg-indigo-600 text-white';
            }
        }

        function addHabit() {
            const nameInput = document.getElementById('newHabitName');
            const goalInput = document.getElementById('newHabitGoal');
            
            if (nameInput.value.trim()) {
                const habit = {
                    id: Date.now(),
                    name: nameInput.value,
                    emoji: '‚≠ê',
                    goal: parseInt(goalInput.value) || 30,
                    completions: {}
                };
                
                state.habits.push(habit);
                nameInput.value = '';
                goalInput.value = '30';
                saveToLocalStorage();
                render();
                lucide.createIcons();
            }
        }

        function deleteHabit(id) {
            state.habits = state.habits.filter(h => h.id !== id);
            saveToLocalStorage();
            render();
        }

        function toggleDay(habitId, day) {
            state.habits = state.habits.map(habit => {
                if (habit.id === habitId) {
                    const key = `${state.selectedYear}-${state.selectedMonth}-${day}`;
                    const completions = { ...habit.completions };
                    
                    if (completions[key]) {
                        delete completions[key];
                    } else {
                        completions[key] = true;
                    }
                    
                    return { ...habit, completions };
                }
                return habit;
            });
            
            saveToLocalStorage();
            render();
        }

        function isCompleted(habit, day) {
            const key = `${state.selectedYear}-${state.selectedMonth}-${day}`;
            return habit.completions[key] || false;
        }

        function getDaysInMonth(month, year) {
            return new Date(year, month + 1, 0).getDate();
        }

        function getCompletedCount(habit) {
            const daysInMonth = getDaysInMonth(state.selectedMonth, state.selectedYear);
            let completed = 0;
            
            for (let day = 1; day <= daysInMonth; day++) {
                if (isCompleted(habit, day)) completed++;
            }
            
            return completed;
        }

        function getMonthProgress(habit) {
            const completed = getCompletedCount(habit);
            return Math.round((completed / habit.goal) * 100);
        }

        function saveToLocalStorage() {
            localStorage.setItem('habits', JSON.stringify(state.habits));
        }

        function renderDailyView() {
            const daysInMonth = getDaysInMonth(state.selectedMonth, state.selectedYear);
            const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
            
            let html = `
                <div class="overflow-x-auto">
                    <div class="habit-table">
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="border border-gray-300 p-2 text-left sticky-header min-w-[180px]">
                                        –ü—Ä–∏–≤—ã—á–∫–∞
                                    </th>
                                    <th class="border border-gray-300 p-2 text-center min-w-[60px]">
                                        –¶–µ–ª—å
                                    </th>
            `;
            
            // –î–Ω–∏ –º–µ—Å—è—Ü–∞
            days.forEach(day => {
                html += `<th class="border border-gray-300 p-1 text-center min-w-[40px] text-sm">${day}</th>`;
            });
            
            html += `
                                    <th class="border border-gray-300 p-2 text-center min-w-[80px]">
                                        –ü—Ä–æ–≥—Ä–µ—Å—Å
                                    </th>
                                    <th class="border border-gray-300 p-2 sticky-right bg-gray-100 min-w-[50px]"></th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            // –°—Ç—Ä–æ–∫–∏ –ø—Ä–∏–≤—ã—á–µ–∫
            state.habits.forEach(habit => {
                const progress = getMonthProgress(habit);
                const completed = getCompletedCount(habit);
                
                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="border border-gray-300 p-2 sticky-left bg-white">
                            <span class="mr-2">${habit.emoji}</span>
                            ${habit.name}
                        </td>
                        <td class="border border-gray-300 p-2 text-center">
                            ${habit.goal}
                        </td>
                `;
                
                // –Ø—á–µ–π–∫–∏ –¥–Ω–µ–π
                days.forEach(day => {
                    const completedClass = isCompleted(habit, day) ? '' : 'opacity-0';
                    html += `
                        <td 
                            class="border border-gray-300 p-1 text-center cursor-pointer hover:bg-blue-50"
                            onclick="toggleDay(${habit.id}, ${day})"
                        >
                            <i data-lucide="check" class="w-5 h-5 text-green-600 mx-auto ${completedClass}"></i>
                        </td>
                    `;
                });
                
                html += `
                        <td class="border border-gray-300 p-2 text-center">
                            <div class="flex flex-col items-center">
                                <span class="font-semibold">${progress}%</span>
                                <span class="text-xs text-gray-600">
                                    ${completed}/${habit.goal}
                                </span>
                            </div>
                        </td>
                        <td class="border border-gray-300 p-2 text-center sticky-right bg-white">
                            <button
                                onclick="deleteHabit(${habit.id})"
                                class="text-red-500 hover:text-red-700"
                            >
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            return html;
        }

        function renderWeeklyView() {
            let html = `
                <div class="overflow-x-auto">
                    <div class="habit-table">
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="border border-gray-300 p-2 text-left sticky-header min-w-[180px]">
                                        –ü—Ä–∏–≤—ã—á–∫–∞
                                    </th>
                                    <th class="border border-gray-300 p-2 text-center min-w-[60px]">
                                        –¶–µ–ª—å
                                    </th>
            `;
            
            // –î–Ω–∏ –Ω–µ–¥–µ–ª–∏
            weekDays.forEach(day => {
                html += `<th class="border border-gray-300 p-2 text-center min-w-[50px]">${day}</th>`;
            });
            
            html += `
                                    <th class="border border-gray-300 p-2 text-center min-w-[80px]">
                                        –ü—Ä–æ–≥—Ä–µ—Å—Å
                                    </th>
                                    <th class="border border-gray-300 p-2 sticky-right bg-gray-100 min-w-[50px]"></th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            // –°—Ç—Ä–æ–∫–∏ –ø—Ä–∏–≤—ã—á–µ–∫
            state.habits.forEach(habit => {
                const progress = getMonthProgress(habit);
                const completed = getCompletedCount(habit);
                const daysInMonth = getDaysInMonth(state.selectedMonth, state.selectedYear);
                
                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="border border-gray-300 p-2 sticky-left bg-white">
                            <span class="mr-2">${habit.emoji}</span>
                            ${habit.name}
                        </td>
                        <td class="border border-gray-300 p-2 text-center">
                            ${habit.goal}
                        </td>
                `;
                
                // –Ø—á–µ–π–∫–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏ (—Ç–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è)
                const today = new Date();
                const currentDay = today.getDate();
                
                for (let i = 0; i < 7; i++) {
                    const targetDay = currentDay - today.getDay() + 1 + i;
                    
                    html += `
                        <td 
                            class="border border-gray-300 p-2 text-center cursor-pointer hover:bg-blue-50"
                            onclick="toggleDay(${habit.id}, ${targetDay})"
                        >
                    `;
                    
                    if (targetDay > 0 && targetDay <= daysInMonth && isCompleted(habit, targetDay)) {
                        html += `<i data-lucide="check" class="w-5 h-5 text-green-600 mx-auto"></i>`;
                    }
                    
                    html += `</td>`;
                }
                
                html += `
                        <td class="border border-gray-300 p-2 text-center">
                            <div class="flex flex-col items-center">
                                <span class="font-semibold">${progress}%</span>
                                <span class="text-xs text-gray-600">
                                    ${completed}/${habit.goal}
                                </span>
                            </div>
                        </td>
                        <td class="border border-gray-300 p-2 text-center sticky-right bg-white">
                            <button
                                onclick="deleteHabit(${habit.id})"
                                class="text-red-500 hover:text-red-700"
                            >
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            return html;
        }

        function renderStats() {
            const statsContainer = document.getElementById('statsContainer');
            const statsGrid = document.getElementById('statsGrid');
            const currentMonth = document.getElementById('currentMonth');
            
            if (state.habits.length === 0) {
                statsContainer.classList.add('hidden');
                return;
            }
            
            statsContainer.classList.remove('hidden');
            currentMonth.textContent = months[state.selectedMonth];
            statsGrid.innerHTML = '';
            
            state.habits.forEach(habit => {
                const progress = getMonthProgress(habit);
                const completed = getCompletedCount(habit);
                
                const statCard = document.createElement('div');
                statCard.className = 'p-4 bg-gray-50 rounded-lg';
                statCard.innerHTML = `
                    <div class="flex items-center mb-2">
                        <span class="text-2xl mr-2">${habit.emoji}</span>
                        <span class="font-semibold">${habit.name}</span>
                    </div>
                    <div class="mb-2">
                        <div class="flex justify-between text-sm mb-1">
                            <span>${completed} / ${habit.goal} –¥–Ω–µ–π</span>
                            <span class="font-semibold">${progress}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div
                                class="bg-gradient-to-r from-green-400 to-green-600 h-3 rounded-full transition-all"
                                style="width: ${Math.min(progress, 100)}%"
                            ></div>
                        </div>
                    </div>
                    ${progress >= 100 ? '<span class="text-green-600 text-sm font-semibold">üéâ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!</span>' : ''}
                `;
                
                statsGrid.appendChild(statCard);
            });
        }

        function render() {
            const habitsContainer = document.getElementById('habitsContainer');
            
            if (state.habits.length === 0) {
                habitsContainer.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <p class="text-lg">–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –ø—Ä–∏–≤—ã—á–∫—É!</p>
                    </div>
                `;
            } else {
                habitsContainer.innerHTML = state.view === 'daily' ? renderDailyView() : renderWeeklyView();
            }
            
            renderStats();
            lucide.createIcons(); // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫–∏ –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞
        }

        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ onclick –∞—Ç—Ä–∏–±—É—Ç–∞—Ö
        window.toggleDay = toggleDay;
        window.deleteHabit = deleteHabit;
    </script>
</body>
</html>